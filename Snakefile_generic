import numpy as np

wildcard_constraints:
    measurment_directory="\w+"


# IRI datasets
configfile: "data/raw/ifj_data/TODO/config.yaml"
datasets = config["datasets"]
background = config["background"]
measurement_directory = config["measurment_directory"]

radius = config["radius"]

# basic datasets
ff_white_image = '2022_08_22_flat_field/FF_2sLED_U340/FF_1'

#radius = 300
vmax_ref_data = 50

# master rule which requires generates all plots
rule all:
    input:
        # expect raw file readed for basic, IRI and FF datasets
        expand(
            "data/interim/ifj_data/{measurment_directory}/{datasets}/raw.npy",
            zip,
            datasets=datasets,
            measurment_directory=[measurement_directory]*len(datasets)
        ),
        expand(
            "data/interim/ifj_data/{measurment_directory}/{datasets}/raw-after-ff.npy",
            zip,
            datasets=datasets,
            measurment_directory=[measurement_directory]*len(datasets)
        ),
        expand(
            "data/interim/ifj_data/{measurment_directory}/{datasets}/raw-aligned.npy",
            zip,
            datasets=datasets,
            measurment_directory=[measurement_directory]*len(datasets)
        ),
        expand(
            "data/interim/ifj_data/{measurment_directory}/stages.pdf",
            zip,
            datasets=datasets,
            measurment_directory=[measurement_directory]*len(datasets)
        )


include: "rules/raw.smk"


rule plot_all_stages:
    input:
        plot_file=expand("data/interim/ifj_data/{measurment_directory}/{datasets}/stages.pdf", 
            zip,
            datasets=datasets,
            measurment_directory=[measurement_directory]*len(datasets))
    output:
        plot_file="data/interim/ifj_data/{measurment_directory}/stages.pdf",
    shell:
        "pdftk {input.plot_file} cat output {output.plot_file}"